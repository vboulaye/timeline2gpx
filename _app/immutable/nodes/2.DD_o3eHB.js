import{a as O,t as G}from"../chunks/disclose-version.DaNAb6Ey.js";import{l as X,a8 as te,a9 as ae,h as B,aa as re,ab as se,ac as oe,Z as A,$ as m,a0 as w,a1 as x,X as ie,Y as ne,_ as le,d as l,c as u,ad as y}from"../chunks/runtime.nP1E8Gge.js";import{d as ce,l as de,a as q,e as fe,f as R}from"../chunks/store.BQNrfC_v.js";import{p as ue,i as ve,a as L}from"../chunks/props.DO5snHGX.js";function pe(e){if(X){var t=!1,a=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;S(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var r=e.checked;S(e,"checked",null),e.checked=r}}};e.__on_r=a,te(a),ce()}}function me(e,t){var a=e.__attributes??(e.__attributes={});a.value===(a.value=t)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t)}function S(e,t,a,s){var r=e.__attributes??(e.__attributes={});X&&(r[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||r[t]!==(r[t]=a)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[ae]=a),a==null?e.removeAttribute(t):typeof a!="string"&&we(e).includes(t)?e[t]=a:e.setAttribute(t,a))}var V=new Map;function we(e){var t=V.get(e.nodeName);if(t)return t;V.set(e.nodeName,t=[]);for(var a,s=B(e),r=Element.prototype;r!==s;){a=re(s);for(var n in a)a[n].set&&t.push(n);s=B(s)}return t}function ge(e,t,a=t){var s=se();de(e,"input",()=>{var r=N(e)?E(e.value):e.value;a(r),s&&r!==(r=t())&&(e.value=r??"")}),oe(()=>{var r=t();if(X&&e.defaultValue!==e.value){a(N(e)?E(e.value):e.value);return}N(e)&&r===E(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function N(e){var t=e.type;return t==="number"||t==="range"}function E(e){return e===""?null:+e}async function _e(){const e=new TransformStream,t=e.writable.getWriter();return be(e.readable),t}async function be(e){const t="output.gpx";if("showSaveFilePicker"in window)try{const s=await(await window.showSaveFilePicker({suggestedName:t,types:[{description:"GPX File",accept:{"application/gpx+xml":[".gpx"]}}]})).createWritable();await e.pipeTo(s)}catch(a){console.error("Error saving file:",a)}else{const s=await new Response(e).blob(),r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}var he=G('<div class="mb-6"><label class="mb-2 block text-sm font-medium text-gray-700"> </label> <input type="datetime" class="w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></div>');function Y(e,t){let a=ue(t,"value",15);var s=he(),r=m(s),n=m(r,!0);w(r);var v=x(r,2);pe(v),w(s),A(()=>{S(r,"for",t.id),q(n,t.label),S(v,"id",t.id)}),ge(v,a),O(e,s)}async function ye(e,t){const a=e.target.files[0];await t(a)}function xe(e,t){u(t,!0)}var ke=G('<button type="button" class="rounded-md bg-red-600 px-4 py-2 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">Stop</button>'),Se=G(`<form class="mx-auto mt-8 max-w-md rounded-lg bg-white p-6 shadow-lg"><!> <!> <div class="mb-6 space-y-4"><input type="file" id="inputFile" value="load file" class="block w-full text-sm text-gray-500
          file:mr-4 file:rounded-md file:border-0
          file:bg-blue-50 file:px-4
          file:py-2 file:text-sm
          file:font-semibold file:text-blue-700
          hover:file:bg-blue-100"> <!></div> <div class="mb-6"><progress max="100" class="h-2 w-full overflow-hidden rounded-full bg-gray-200 svelte-7d5tdg"><div class="h-full bg-blue-600"></div></progress></div></form> <pre> </pre>`,1);function Re(e,t){ie(t,!0);let a=y(""),s=y(""),r=y(""),n=y(0),v=y(!1),D=y(!1);async function*J(o){const i=new TextDecoder;let c="";const P=o.size;let _=0,k=0;const p=o.stream().getReader();for(;!l(v);){const{done:d,value:b}=await p.read();if(d){c.length>0&&(yield c);break}_+=b.length,u(n,_/P*100),c+=i.decode(b);const f=c.split(`
`);k+=f.length,k>=1e3&&(k=0,await new Promise(h=>setTimeout(h,0))),c=f.pop()??"";for(const h of f)yield h}}async function I(o){const i=await _e(),c=`
	<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="Example GPX Writer"
     xmlns="http://www.topografix.com/GPX/1/1"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/1
     http://www.topografix.com/GPX/1/1/gpx.xsd">

  <metadata>
    <name>${o.name}</name>
    <time>${new Date().toISOString()}</time>
  </metadata>
`,P=new Intl.DateTimeFormat,_=new TextEncoder;await i.write(_.encode(c));const k=l(s)?new Date(l(s)):null,j=l(r)?new Date(l(r)):null;u(v,!1),u(D,!0);try{let p=!1,d={point:[0,0],timestamp:new Date};for await(const b of J(o)){switch(b){case'      "timelinePath": [':p=!0;break;case"      ]":if(p=!1,Z(d.timestamp,k,j)){const f=`<wpt lat="${d.point[0]}" lon="${d.point[1]}"><time>${d.timestamp.toISOString()}</time></wpt>
`;i.write(_.encode(f)),u(a,L(JSON.stringify(d)))}else u(a,"Skipping "+P.format(d.timestamp));break}if(p){const f=b.match(/\s+"point": "(.*)°, (.*)°",/);if(f)d.point=[parseFloat(f[1]),parseFloat(f[2])];else{const h=b.match(/\s+"time": "(.*)"/);h&&(d.timestamp=new Date(h[1]))}}}await i.write(_.encode("</gpx>")),await i.close()}catch(p){console.error("Error processing file:",p),await i.abort(p)}finally{u(D,!1)}}async function K(o){const i=o.dataTransfer.files[0];await I(i)}function Z(o,i,c){return(!i||o>=i)&&(!c||o<=c)}var M=Se(),g=ne(M),U=m(g);Y(U,{id:"startDateTime",get value(){return l(s)},set value(o){u(s,L(o))},label:"Start date"});var z=x(U,2);Y(z,{id:"endDateTime",get value(){return l(r)},set value(o){u(r,L(o))},label:"End date"});var T=x(z,2),C=m(T);C.__change=[ye,I];var H=x(C,2);ve(H,()=>l(D),o=>{var i=ke();i.__click=[xe,v],A(()=>i.disabled=l(v)),O(o,i)}),w(T);var W=x(T,2),F=m(W),Q=m(F);w(F),w(W),w(g);var $=x(g,2),ee=m($);w($),A(()=>{me(F,l(n)),S(Q,"style",`width: ${l(n)??""}%`),q(ee,`
    ${l(a)??""}
`)}),R("submit",g,o=>o.preventDefault()),R("drop",g,K),R("dragover",g,o=>o.preventDefault()),O(e,M),le()}fe(["change","click"]);export{Re as component};
